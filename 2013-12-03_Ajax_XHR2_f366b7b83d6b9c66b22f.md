<!--
title:   ファイルダウンロードが開くリンクから直接クライアントJSにデータ読み込みする
tags:    Ajax,XHR2
id:      f366b7b83d6b9c66b22f
private: false
-->
# 概要
通常はファイルダウンロードダイアログが開くデータを、JSプログラム中に読み込んで扱えるようにする。

## 方法１：データタイプを指定する（XHR2）
xhrならば`XMLHttpRequest.responseType`で応答テキストの取り扱いタイプを変更できる。

``` js
$(function (){

    var xhr = new XMLHttpRequest();
    xhr.open('GET', '../csv/data.csv', true);
    xhr.responseType = 'text';

    xhr.onload = function(e) {
        var response_document = this.responseText;
        console.log(response_document);
    };
    xhr.send();
});
```

jQueryなら`dataType`を指定

```js
$(function (){
    var data_src = '../data/location_list.csv';

    var parse_data = function(res){
        var dataArray = CSVData.parse(res);
        alert(dataArray);
    }

    $.ajax(
            {
                url     : data_src,
                type    : 'GET',
                cache   : false,
                dataType: 'text',
                success : parse_data
            }
    );
});
```

## 方法２：`XMLHttpRequest.overrideMimeType`を指定する
読み込みの文字コードも変更したいなどの時はこちら。

``` js
$(function (){

    var xhr = new XMLHttpRequest();
    xhr.open('GET', '../csv/data.csv', true);
    xhr.overrideMimeType('text/plain; charset=shift-jis');

    xhr.onload = function(e) {
        var response_document = this.responseText;
        console.log(response_document);
    };
    xhr.send();
});
```

```js
$(function (){
    var data_src = '../data/location_list.csv';

    var parse_data = function(res){
        var dataArray = CSVData.parse(res);
        alert(dataArray);
    }

    $.ajax(
            {
                url     : data_src,
                type    : "GET",
                cache   : false,
                mimeType: 'text/plain; charset=shift-jis',
                success : parse_data
            }
    );
});
```

# 参考サイト
- [XMLHttpRequest2 に関する新しいヒント - HTML5 Rocks](http://www.html5rocks.com/ja/tutorials/file/xhr2/)
- [Ajaxの文字化けとその解決法 | 言葉の海のプログラマー](http://lostlinksearch.net/blog/2012/03/ajax%E3%81%AE%E6%96%87%E5%AD%97%E5%8C%96%E3%81%91%E3%81%A8%E3%81%9D%E3%81%AE%E8%A7%A3%E6%B1%BA%E6%B3%95/)
- [jQuery.ajax() | jQuery API Documentation](http://api.jquery.com/jQuery.ajax/)